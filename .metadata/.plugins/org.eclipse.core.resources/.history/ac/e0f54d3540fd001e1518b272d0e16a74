/*
 * buzzer.c
 *
 *  Created on: Apr 15, 2024
 *      Author: kccistc
 */

#include "buzzer.h"

int soundLUT[] = {1046, 1175, 1318, 1397, 1568, 1760, 1975, 2092};

void initSound(TIM_HandleTypeDef *htim3){
	HAL_TIM_PWM_Start(htim3, TIM_CHANNEL_4);
	stopSound(htim3);
}

void setSound(int freq , TIM_HandleTypeDef *htim3){
	htim3->Instance->ARR = 1000000/freq - 1;
	htim3->Instance->CCR4 = htim3->Instance->ARR / 2;
}

void safeDriveModeSound(TIM_HandleTypeDef *htim3){
	setSound(1121, htim3);
}

void stopSound(TIM_HandleTypeDef *htim3){
	htim3->Instance->CCR4 = 0;
}

void manualModeSound(TIM_HandleTypeDef *htim3){
	setSound(soundLUT[0], htim3);
	HAL_Delay(150);
	setSound(soundLUT[2], htim3);
	HAL_Delay(150);
	setSound(soundLUT[4], htim3);
	HAL_Delay(150);
	setSound(soundLUT[7], htim3);
	HAL_Delay(150);
}

void autoModeSound(TIM_HandleTypeDef *htim3){
	setSound(soundLUT[7], htim3);
	HAL_Delay(150);
	setSound(soundLUT[4], htim3);
	HAL_Delay(150);
	setSound(soundLUT[2], htim3);
	HAL_Delay(150);
	setSound(soundLUT[0], htim3);
	HAL_Delay(150);
}

void suddenlyStopSound(TIM_HandleTypeDef *htim3){
	setSound(soundLUT[2], htim3);
	HAL_Delay(100);
	setSound(soundLUT[0], htim3);
	HAL_Delay(100);
	setSound(soundLUT[2], htim3);
	HAL_Delay(100);
	setSound(soundLUT[0], htim3);
	HAL_Delay(100);
	setSound(soundLUT[2], htim3);
	HAL_Delay(100);
	setSound(soundLUT[0], htim3);
	HAL_Delay(100);
}
