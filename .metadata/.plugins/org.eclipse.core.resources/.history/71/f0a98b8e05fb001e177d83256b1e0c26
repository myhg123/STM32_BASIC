/*
 * Motor.c
 *
 *  Created on: Apr 14, 2024
 *      Author: myhg1
 */
#include "Motor.h"

void manualDriveStart(TIM_HandleTypeDef* htim4,int16_t xAxis, int16_t yAxis){
	xAxis = xAxis - 2118;
	yAxis = yAxis - 2068;
	//ccr1 left, ccr2 right
	//left wheel
	if(yAxis> 100){
		rightDriveForward();
		htim4->Instance->CCR2 = map(abs(yAxis),100,2060,0,65535);
	}
	else if(yAxis<-100){
		rightDriveBackward();
		htim4->Instance->CCR2 = map(abs(yAxis),100,2100,0,65535);
	}

	//Right wheel
	if(xAxis> 100){
		leftDriveForward();
		htim4->Instance->CCR1 = map(abs(xAxis),100,2000,0,65535);
	}
	else if(xAxis<-100){
		leftDriveBackward();
		htim4->Instance->CCR1 = map(abs(xAxis),100,2150,0,65535);
	}
	printf("%d,%d, %04x\n",xAxis,yAxis, GPIOB->ODR);
}

void MoveStop(TIM_HandleTypeDef* htim){
	htim->Instance->CCR1 = 0;
	htim->Instance->CCR2 = 0;
}

void goMove(TIM_HandleTypeDef* htim4){
   rightDriveForward();
   leftDriveForward();
   htim4->Instance->CCR2 = 65535;
   htim4->Instance->CCR1 = 65535*0.99f;
}

void backMove(TIM_HandleTypeDef* htim4){
   rightDriveBackward();
   leftDriveBackward();
   htim4->Instance->CCR2 = 65535;
   htim4->Instance->CCR1 = 65535;
}

void rightDriveForward(){
	HAL_GPIO_WritePin(Left_IN3_GPIO_Port, Left_IN3_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(Left_IN4_GPIO_Port, Left_IN4_Pin, GPIO_PIN_SET);
}

void leftDriveForward(){
	HAL_GPIO_WritePin(Right_IN1_GPIO_Port, Right_IN1_Pin, GPIO_PIN_SET);
	HAL_GPIO_WritePin(Right_IN2_GPIO_Port, Right_IN2_Pin, GPIO_PIN_RESET);
}

void rightDriveBackward(){
	HAL_GPIO_WritePin(Left_IN3_GPIO_Port, Left_IN3_Pin, GPIO_PIN_SET);
	HAL_GPIO_WritePin(Left_IN4_GPIO_Port, Left_IN4_Pin, GPIO_PIN_RESET);
}

void leftDriveBackward(){
	HAL_GPIO_WritePin(Right_IN1_GPIO_Port, Right_IN1_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(Right_IN2_GPIO_Port, Right_IN2_Pin, GPIO_PIN_SET);
}


