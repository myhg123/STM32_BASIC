/*
 * joystick.c
 *
 *  Created on: Apr 12, 2024
 *      Author: myhg1
 */
#include "joystick.h"
void dataToUart(uint8_t data){
	HAL_UART_Transmit_IT(&huart1, &data, 1);
	HAL_Delay(10);
}

void adcData_Filt(uint16_t* buf, uint16_t* Xfilt, uint16_t* Yfilt){
	*Xfilt = *Xfilt * X + buf[0] * (1.0f - X);
	*Yfilt = *Yfilt * X + buf[1] * (1.0f - X);

	adcDataMaxMin(&Xfilt);
	adcDataMaxMin(&Yfilt);

}
void dataTransmit(uint16_t Xdata, uint16_t Ydata){
		uint8_t tx_data1,tx_data2,tx_data3,tx_data4;
		tx_data1= Xdata>>8;
		tx_data2= Xdata;
		tx_data3= Ydata>>8;
		tx_data4= Ydata;
		dataToUart(STX);
		dataToUart(ETX);
		dataToUart(tx_data1);
		dataToUart(tx_data2);
		dataToUart(tx_data3);
		dataToUart(tx_data4);

		uint8_t chksum=0;
		chksum = STX + ETX + tx_data1 + tx_data2 + tx_data3 + tx_data4;
		dataToUart(chksum);
  	printf("%d,%d,%d,%d\n",tx_data1,tx_data2,tx_data3,tx_data4);

}

void adcDataMaxMin(uint16_t *data) {
	if (*data > 4096) {
		*data = 4096;
	}
	if (*data < 15) {
		*data = 0;
	}
}

long map(long x, long in_min, long in_max, long out_min, long out_max) {
	return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
}

